function timer_background(event, time_bar, percent) {
    if (time_bar.is(':visible')) {
        event.css('background', '#2c2d2d');
        time_bar.css({
            'background': `linear-gradient(90deg, rgba(0, 210, 91, 0.2) ${percent}%, #2c2d2d ${percent}%)`
        })
    } else {
        time_bar.css({
            'background': '#2c2d2d'
        })
        event.css({
            'background': `linear-gradient(90deg, rgba(0, 210, 91, 0.2) ${percent}%, #2c2d2d ${percent}%)`,
        })
    }
    time_bar.text(`${percent.toFixed(2)}%`);
}
function interval() {
    var date = new Date();
    var nro_day = date.getDay();
    var now = moment().format('HH:mm:ss');
    $(`#${nro_day} tbody tr`).each(function() {
        if ($(this).find('td').length === 3) {
            var start = $(this).find('td:eq(0)').text() + ':00';
            var end = $(this).find('td:eq(1)').text() + ':00';
            var _start = start.split(':');
            var _end = end.split(':');
            var _now = now.split(':');
            var event = $(this).find('td:eq(2)');
            var time_bar = event.find('.time_bar');
            if (now == start) {
                var object = JSON.parse($(this).attr('data-event'));
                textToSpeech(object.voice.start
                    .replaceAll('{subject}', object.subject.name)
                    .replaceAll('{attendant}', object.attendant.name)
                );
                // abrir una pestaÃ±a en el mismo navegador
                window.open(object.subject.links[0].url, '_blank');
            }
            if (now > end) {
                timer_background(event, time_bar, 100)
            } else if (start <= now && now <= end) {
                var s_start = (_start[0] * 3600) + (_start[1] * 60) + (_start[2] * 1);
                var s_end = (_end[0] * 3600) + (_end[1] * 60) + (_end[2] * 1);
                var s_now = (_now[0] * 3600) + (_now[1] * 60) + (_now[2] * 1);
                var percent = (s_now - s_start) * 100 / (s_end - s_start);
                timer_background(event, time_bar, percent)
            }
        }
    })
}
setInterval(interval, 1000);